# XPOS Data Format

version 0.1.0

## <a id="sec-1"></a> 1. Abstract - 概要

この文書は、高い移植性を持ち、大きな仕様上のキャパシティを持つデータ交換用の形式であるXPOSのフォーマットの定義を行う。

### <a id="sec-1-1"></a> 1.1. Status - 本書の位置づけ

本書は、インターネットコミュニティへの情報提供のためのものであり、標準を構成するものではない。
本書の配布は無制限である。

### <a id="sec-1-2"></a> 1.2. Index - 目次

-	[1 概要](#sec-1)
	-	[1.1 本書の位置づけ](#sec-1-1)
	-	[1.2 目次](#sec-1-2)
-	[2 用語と頭字語](#sec-2)
-	[3 型](#sec-3)
	-	[3.1 プリミティブ型](#sec-3-1)
		-	[3.1.1 整数型](#sec-3-1-1)
		-	[3.1.2 バイナリ型](#sec-3-1-2)
		-	[3.1.3 文字列型](#sec-3-1-3)
		-	[3.1.4 実数型](#sec-3-1-4)
		-	[3.1.5 コレクション型](#sec-3-1-5)
	-	[3.2 名前型](#sec-3-2)
	-	[3.3 拡張オブジェクト型](#sec-3-3)
-	[4 XPOS データフォーマット](#sec-4)
	-	[4.1 ワード](#sec-4-1)
	-	[4.2 識別子](#sec-4-2)
	-	[4.3 整数型 オブジェクト記述](#sec-4-3)
		-	[4.3.1 単一ワード整数型](#sec-4-3-1)
		-	[4.3.2 多倍ワード整数型](#sec-4-3-2)
	-	[4.4 バイナリ型 オブジェクト記述](#sec-4-4)
		-	[4.4.1 単一ワード長バイナリ型](#sec-4-4-1)
		-	[4.4.2 多倍ワード長バイナリ型](#sec-4-4-2)
	-	[4.5 文字列型 オブジェクト記述](#sec-4-5)
		-	[4.5.1 単一ワード長文字列型](#sec-4-5-1)
		-	[4.5.2 多倍ワード長文字列型](#sec-4-5-2)
	-	[4.6 実数型 オブジェクト記述](#sec-4-6)
	-	[4.7 コレクション型 オブジェクト記述](#sec-4-7)
		-	[4.7.1 単一ワード長コレクション型](#sec-4-7-1)
		-	[4.7.2 多倍ワード長コレクション型](#sec-4-7-2)
	-	[4.8 名前型 オブジェクト記述](#sec-4-8)
	-	[4.9 拡張オブジェクト型 オブジェクト記述](#sec-4-9)
	-	[4.10 マジックナンバー](#sec-4-10)
	-	[4.11 XPOS データ記述](#sec-4-11)
-	[5 仕様の策定者への勧告](#sec-5)
	-	[5.1 オブジェクト配置の規則](#sec-5-1)
	-	[5.2 日付と時間の記述](#sec-5-2)
-	[6 デコーダーへの勧告](#sec-6)
	-	[6.1 実装における要求](#sec-6-1)
-	[7 エンコーダーへの勧告](#sec-7)
	-	[7.1 実数型の扱い](#sec-7-1)


## <a id="sec-2"></a> 2. Terms and Acronyms - 用語と頭字語

-	**Bit (ビット)** --
	二進数で`0`または`1`で表される量。
	本書では特に断りのない限りビット列を最初のビットから順に"`bbbb...`b"と表記する。

-	**Byte (バイト)** --
	8個のビット列。
	本書では特に断りのない限りバイト列を最初のバイトから順に"`xx xx ...`h"と表記する。

-	**Extended Identifier (拡張識別子)** --
	拡張データ型(3.3章)において、内容となる拡張データの種類を特定するための4バイトのビット列。

-	**Magic Number (マジックナンバー)** --
	XPOSデータを識別するために先頭に付与されるビット列。

-	**Identifier (識別子)** --
	特定のプリミティブ型を他の型と区別するために用いる一意のバイト列。

-	**Name (名前)** --
	オブジェクトを一意に識別するために付与する文字列。

-	**Object (オブジェクト)** --
	特定の型によるデータを持つエンティティ。

-	**Primitive Type (プリミティブ型)** --
	データ構造を記述するための最小単位となるデータの型。
	3.1章を参照。

-	**Word (ワード)** --
	4個のバイトの集まり。
	本書では特に断りのない限りワード列を最初のワードから順に

		xx xx xx xx  xx xx xx xx
		xx xx xx xx  xx xx xx xx
		...

	と表記する。

-	**XPOS** --
	Extensible Primitive-Object Structure の略。


## <a id="sec-3"></a> 3. Types - 型

### <a id="sec-3-1"></a> 3.1. Primitive Types - プリミティブ型

XPOSでは、次の5種類の型をプリミティブ型と総称し、扱うこととする。

-	Integer Type - 整数型
-	Binary Type - バイナリ型
-	String Type - 文字列型
-	Real Number Type - 実数型
-	Collection Type - コレクション型

XPOSデータはプリミティブ型のみですべてのデータを再現できなくてはならない。
つまり、プリミティブ型ではないオブジェクトに依存するプリミティブ型オブジェクトが存在してはならず、
拡張オブジェクト型のオブジェクトが削除されても内容を再現できなくてはならないということである。

#### <a id="sec-3-1-1"></a> 3.1.1. Integer Type - 整数型

整数型は、整数を記述するためのプリミティブ型である。
扱う整数は2の補数による符号付きの整数であり、バイトオーダーはビッグエンディアンである。

整数型は、文字列型やバイナリ型においてそのデータサイズの表現を行う際にも用いられる。

#### <a id="sec-3-1-2"></a> 3.1.2. Binary Type - バイナリ型

バイナリ型は、ビット列を記述するためのプリミティブ型である。

#### <a id="sec-3-1-3"></a> 3.1.3. String Type - 文字列型

文字列型は、Unicode文字列を記述するためのプリミティブ型である。
扱う文字列はUTF-8エンコードであり、null文字(\\0)によって終端する必要はない。

内部のデータは正しいUTF-8エンコードのUnicode形式でなければならない。

文字列型は、コレクション型内でオブジェクトに名前をつける際にも用いられる。

#### <a id="sec-3-1-4"></a> 3.1.4. Real Number Type - 実数型

実数型は、実数を記述するためのプリミティブ型である。
扱う実数は、IEEE-754の浮動小数点数のうち、二進法の基本形式

-	単精度 (binary32)
-	倍精度 (binary64)
-	四倍精度 (binary128)

および交換形式

-	半精度 (binary16)
-	四倍精度以上 (binary160 ...)

のいずれかである。

また、バイトオーダーはビッグエンディアンである。

#### <a id="sec-3-1-5"></a> 3.1.5. Collection Type - コレクション型

コレクション型は、内部に0個以上のデータを置くことができるプリミティブ型である。
コレクション型を含むすべてのプリミティブ型を配置することができるため、入れ子構造を作成することができる。

コレクション型オブジェクト内のオブジェクトは順序を持ち、通常データ内で現れた順に並ぶ。

コレクション型に含めるそれぞれのオブジェクトには名前を付けることができる。
コレクション型内のオブジェクトのすべてに名前をつける必要はなく、名前を部分的に付与することもできる。
付与する名前は名前型([3.2.参照](@sec-3-2))の仕様に従う。

### <a id="sec-3-2"></a> 3.2. Object Name Type - 名前型

名前型はコレクション型内に含まれるオブジェクトの名前を定義するための型である。

名前型の内容は文字列型([3.1.3.参照](#sec-3-1-3))と同等である。
文字列型で課される制限に加え、

-	a) 使用可能な文字は制御文字(null文字\\0、改行\\n、タブ\\tなど)や絵文字を除いたUnicode印刷文字、およびスペース(U+0020"SPACE", U+3000"IDEOGRAPHIC SPACE")のみとする
-	b) 名前の先頭・あるいは末尾がスペースであったり、スペースのみで構成されていてはならない
-	c) 最大の長さは65535バイトとする
-	d) 同一のコレクション型のデータ内で名前が重複してはならない

といった制約が課される。

名前型のオブジェクトは依存するプリミティブ型オブジェクトがちょうど1つ存在しなくてはならない。
また、名前型オブジェクトがプリミティブ型ではないオブジェクトに依存してはならない。

### <a id="sec-3-3"></a> 3.3. Extended Object Type - 拡張オブジェクト型

プリミティブ型に付随するプライベートデータを記述するための型であり、データの種類を区別するための拡張識別子と、その内容を表すビット列を持つことができる。

この型はデータの再現に必須ではないデータを記述するために用いることができる。例えば、

-	標準仕様に含まれていない機能のために互換性のある標準仕様のデータに追加されるデータ
-	データの再現を行うにあたって、効率化のために置かれるデータ構造のバイナリ

などが挙げられる。

拡張オブジェクト型のオブジェクトは依存するプリミティブ型オブジェクトがちょうど1つ存在しなくてはならない。
また、拡張オブジェクト型オブジェクトがプリミティブ型ではないオブジェクトに依存してはならない。

デコーダはこの型のデータに遭遇した場合、拡張識別子を確認し、対応していないものは読み飛ばしてもよい。
また、デコーダはこの型のいずれのデータも対応する必要はなく、この型に遭遇した場合に無条件で読み飛ばす処理を行ってもよい。

拡張オブジェクト型の内容をコピーすることは基本的に危険であり、XPOSデータの書き出しの際内容を認識しない拡張オブジェクト型のデータをコピーしてはならない。


## <a id="sec-4"></a> 4. XPOS Data Format - XPOS データフォーマット

### <a id="sec-4-1"></a> 4.1. Word - ワード

XPOSフォーマットのデータは4バイトの長さを持つビット列である"ワード"によって構成されている。
1個以上のワードの内容と、その組み合わせによってデータ構造を記述する。

### <a id="sec-4-2"></a> 4.2. Identifier - 識別子

各オブジェクトのデータの最初の1バイトにはオブジェクトの型を識別するための識別子が存在し、すべてのオブジェクト型とその識別子は一対一で関連付けられている。

このデータフォーマットで定義されていない識別子を用いてデータの記述を行ってはならない。
また、このデータフォーマットで定義されている識別子を用いてこのデータフォーマットと異なるデータの記述を行ってはならない。

デコードする際、未知の識別子に遭遇した場合、エラーを発してデータの処理を停止しなくてはならない。

### <a id="sec-4-3"></a> 4.3. Integer Type Object Notation - 整数型 オブジェクト記述

整数型のデータの記述方法は2種類ある。
一方は単一のワードに値を記述する方法、もう一方は以降のワードに値を記述する方法である。

#### <a id="sec-4-3-1"></a> 4.3.1. Short Integer Type - 単一ワード整数型

単一のワードに値を記述する場合、識別子は`69`h (ASCII: "i")である。
続く3バイトに値を記述する。

記述する値は2の補数による符号付きの整数であり、バイトオーダーはビッグエンディアンである。
つまり、大きい値を表すバイトが先に配置される。(B2 B1 B0 の順)

数値25551を整数型にした場合、データの内容は次のようになる。

	69 00 63 CF

単一のワードに値を記述する場合、記述可能な値の範囲は、-8388608(`80 00 00`h)から8388607(`7F FF FF`h)である。

#### <a id="sec-4-3-2"></a> 4.3.2. Long Integer Type - 多倍ワード整数型

複数のワードに値を記述する場合、識別子は`49`h (ASCII: "I")である。
続く3バイトには、記述する値のデータの長さをバイト単位で記述し、次のワード以降に値を記述する。

データの長さは単一ワード整数型([4.3.1.参照](#sec-4-3-1))で値を格納するときのように格納される。

記述する値は2の補数による符号付きの整数であり、バイトオーダーはビッグエンディアンである。
つまり、ひとつのワード内でのバイトの並びはMSBから始まり、LSBで終わる。
同様に複数ワードの並びも大きい値を意味するワードから始まり、小さい値を意味するワードで終わる。

データはワードの境界にアライメントされていなくてはならない。
つまり、データの長さはちょうど4バイトの倍数でなくてはならないということである。

数値3^3^3(=7625597484987)を整数型にした場合、データの内容は次のようになる。

	49 00 06 4B  00 00 06 EF
	79 07 7F BB

データの長さとして記述可能な値の範囲は4(`00 00 04`h)から8388604(`7F FF FB`h)である。
これは、最大で 2.55x10^20201771 までの整数を表現することができることを意味する。

### <a id="sec-4-4"></a> 4.4. Binary Type Object Notation - バイナリ型 オブジェクト記述

バイナリ型のデータの記述方法は2種類ある。
これはデータの長さをどちらの整数型の記述([4.3.参照](#sec-4-3))で表すかによるものである。

#### <a id="sec-4-4-1"></a> 4.4.1. Short Binary Type - 単一ワード長バイナリ型

バイナリの長さが8388608バイト未満である場合、識別子として`62`h (ASCII: "b")を用いる。
続く3バイトには、記述する値のデータの長さをバイト単位で記述し、次のワード以降に値を記述する。

データの長さは単一ワード整数型([4.3.1.参照](#sec-4-3-1))で値を格納するときのように格納される。

格納されるデータは単純なビット列として扱い、それらに対して課される制約はない。
これは、複数バイトで組になる値が存在した場合に、XPOSでそれらのバイト順序を制限したり、
ビット列に対してXPOSでワード単位でのアライメントを要求することはないということである。

データの長さ(バイト単位)が正確に4の倍数ではない場合、データの最後にデータの長さが正確に4の倍数となるように`0`bをパディングする。

#### <a id="sec-4-4-2"></a> 4.4.2. Long Binary Type - 多倍ワード長バイナリ型

バイナリの長さが8388608バイト以上である場合、識別子として`42`h (ASCII: "B")を用いる。
以降はデータの長さをバイト単位で記述する。
データの長さを表す整数型の最後のワードに続いてデータを記述する。

データの長さは多倍ワード整数型([4.3.2.参照](#sec-4-3-2))で値を格納するときのように格納される。

格納されるデータは単純なビット列として扱い、それらに対して課される制約はない。
これは、複数バイトで組になる値が存在した場合に、XPOSでそれらのバイト順序を制限したり、
ビット列に対してXPOSでワード単位でのアライメントを要求することはないということである。

データの長さ(バイト単位)が正確に4の倍数ではない場合、データの最後にデータの長さが正確に4の倍数となるように`0`bをパディングする。

### <a id="sec-4-5"></a> 4.5. String Type Object Notation - 文字列型 オブジェクト記述

文字列型のデータの記述方法は2種類ある。
これは文字列のデータの長さをどちらの整数型の記述([4.4.参照](#sec-4-4))で表すかによるものである。

#### <a id="sec-4-5-1"></a> 4.5.1. Short String Type - 単一ワード長文字列型

文字列の長さが8388608バイト未満である場合、識別子として`73`h (ASCII: "s")を用いる。
続く3バイトには、記述する値のデータの長さをバイト単位で記述し、次のワード以降に値を記述する。

データの長さは単一ワード整数型([4.3.1.参照](#sec-4-4-1))で値を格納するときのように格納される。

格納されるデータは非null終端のUTF-8文字列([3.1.3.参照](#sec-3-1-3))である。

データの長さ(バイト単位)が正確に4の倍数ではない場合、データの最後にデータの長さが正確に4の倍数となるように`0`bをパディングする。

文字列"美しい日本語"を文字列型にした場合、データの内容は次のようになる。

	73 00 00 12  E7 BE 8E E3
	81 97 E3 81  84 E6 97 A5
	E6 9C AC E8  AA 9E 00 00

#### <a id="sec-4-5-2"></a> 4.5.2. Long String Type - 多倍ワード長文字列型

文字列の長さが8388608バイト以上である場合、識別子として`53`h (ASCII: "S")を用いる。
以降は文字列のデータの長さをバイト単位で記述する。
文字列の長さのデータを表す整数型の最後のワードに続いて文字列のデータを記述する。

データの長さは多倍ワード整数型([4.3.2.参照](#sec-4-4-2))で値を格納するときのように格納される。

格納されるデータは非null終端のUTF-8文字列([3.1.3.参照](#sec-3-1-3))である。

データの長さ(バイト単位)が正確に4の倍数ではない場合、データの最後にデータの長さが正確に4の倍数となるように`0`bをパディングする。

<!--
[バベルの図書館の部屋0-棚1-行1-列1の本の内容](http://libraryofbabel.info/book.cgi?0-w1-s1-v01:1)を文字列型にした場合、データの内容は次のようになる。

	53 00 00 04  00 14 05 00
	65 2C 6B 74  ...
	... (中略)
	61 6A 6A 68
-->

### <a id="sec-4-6"></a> 4.6. Real Number Type Object Notation - 実数型 オブジェクト記述

実数型のデータを記述する場合の識別子は`72`h (ASCII: "r")である。
続く3バイトには、記述する値のデータの長さをバイト単位で記述し、次のワード以降に値を記述する。

データの長さは単一ワード整数型([4.3.1.参照](#sec-4-3-1))で値を格納するときのように格納される。

格納される値はIEEE754で定義される、すべての基本形式または交換形式の二進浮動小数点数である。
バイトオーダーはビッグエンディアンである。

格納される浮動小数点数の形式はデータの長さの値によって区別される。
つまり、取りうるデータ長の値は

-	2 `00 00 02`h (binary16)
-	4 `00 00 04`h (binary32)
-	8 `00 00 08`h (binary64)
-	16 `00 00 10`h (binary128)

および16以上の4の倍数であり、それ以外の値がデータ長の値として現れてはならないということである。

データの長さが(バイト単位)正確に4の倍数ではない場合、データの最後にデータの長さが正確に4の倍数となるように`0`bをパディングする。

### <a id="sec-4-7"></a> 4.7. Collection Type Object Notation - コレクション型 オブジェクト記述

コレクション型のデータの記述方法は2種類ある。
これはコレクション型のデータの長さをどちらの整数型の記述([4.4.参照](#sec-4-4))で表すかによるものである。

#### <a id="sec-4-7-1"></a> 4.5.1. Short Collection Type - 単一ワード長コレクション型

データの長さが8388608バイト未満である場合、識別子として`63`h (ASCII: "c")を用いる。
続く3バイトには、内容全体の長さをバイト単位で記述し、次のワード以降にその内容を記述する。

データの長さは単一ワード整数型([4.3.1.参照](#sec-4-4-1))で値を格納するときのように格納される。

コレクション型のデータの内容には、0個以上のプリミティブ型オブジェクトと、記述されたプリミティブ型に依存する名前型、拡張オブジェクト型を記述することができる。
2個以上のオブジェクトを記述する場合、直前のオブジェクトの最後のワードの直後にオブジェクトを記述する。

オブジェクト型のデータは1ワード(4バイト)にアライメントされているため、コレクション型のデータ長は必ず4の倍数に等しくなる。

#### <a id="sec-4-7-2"></a> 4.5.2. Long Collection Type - 多倍ワード長コレクション型

データの長さが8388608バイト以上である場合、識別子として`43`h (ASCII: "C")を用いる。
以降は内容全体の長さをバイト単位で記述する。
内容全体の長さを表す整数型の最後のワードに続いてその内容を記述する。

データの長さは多倍ワード整数型([4.3.2.参照](#sec-4-4-2))で値を格納するときのように格納される。

コレクション型のデータの内容には、0個以上のプリミティブ型オブジェクトと、記述されたプリミティブ型に依存する名前型、拡張オブジェクト型を記述することができる。
2個以上のオブジェクトを記述する場合、直前のオブジェクトの最後のワードの直後にオブジェクトを記述する。

オブジェクト型のデータは1ワード(4バイト)にアライメントされているため、コレクション型のデータ長は必ず4の倍数に等しくなる。

### <a id="sec-4-8"></a> 4.8. Name Type Object Notation - 名前型 オブジェクト記述

コレクション型のオブジェクト内で識別子が`4E`h (ASCII: "N")となっている文字列型オブジェクトが存在する場合、直後のオブジェクトに付けられる名前として扱う。

データの内容は単一ワード長文字列型の記述([4.5.1.参照](#sec-4-5-1))のように記述する。

名前型のオブジェクトは、コレクション型オブジェクト内に存在するプリミティブ型オブジェクトの直前に存在しなくてはならない。
コレクション型オブジェクトの外で名前型オブジェクトが現れたり、名前型オブジェクトの直後にプリミティブ型オブジェクトが現れない場合は、エラーである。

### <a id="sec-4-9"></a> 4.9. Extended Object Type Object Notation - 拡張オブジェクト型 オブジェクト記述

拡張オブジェクト型のデータは、直前のプリミティブ型オブジェクトに依存するデータとして扱う。

拡張オブジェクト型のデータを記述する場合の識別子は`78`h (ASCII: "x")である。
続く3バイトには、記述する値のデータの長さをバイト単位で記述する。
次の1ワードに拡張識別子を置き、それ以降のワードにそのデータを記述する。

データの長さは単一ワード整数型([4.4.1.参照](#sec-4-4-1))で値を格納するときのように格納される。

拡張識別子は32ビットのビット列として扱う。
また、拡張識別子は必ず拡張オブジェクト内に存在する必要があるため、データ長は必ず4以上となる。

データの長さ(バイト単位)が正確に4の倍数ではない場合、データの最後にデータの長さが正確に4の倍数となるように`0`bをパディングする。


### <a id="sec-4-10"></a> 4.10. Magic Number - マジックナンバー

通常、XPOSデータはその内容がXPOSデータフォーマットで記述されていることを識別できるようにするために、
データの先頭にちょうどひとつのマジックナンバーを置く必要がある。

XPOSデータのマジックナンバーは2ワードの長さの固定のビット列であり、その内容は

	80 00 FF 00  58 50 4F 53

である。

XPOSデータを読み込む場合、原則として最初の2ワードを読み込み、
マジックナンバーが一致していることを確認しなければならない。

例外として、外部のフォーマットなどでXPOSデータを含む際、XPOSデータ以外のデータが記述されることがなく、
XPOSデータであるかを検証する必要がないとわかっている場合にはマジックナンバーを含めないよう仕様を策定してもよい。
そのような仕様が明示的に記載されている場合はマジックナンバーを置いてはならない。

### <a id="sec-4-11"></a> 4.11. XPOS Data Notation - XPOS データ記述

XPOSデータを記述するには、まず(必要な場合)最初の2ワードでマジックナンバーを記述し、
続いてプリミティブ型オブジェクトをちょうど一つだけ記述する。
ここに記述したちょうど一つのプリミティブ型オブジェクトがXPOSデータにおけるオブジェクトツリーのルートとなる。

プリミティブ型オブジェクトは必須であり、0個以下であっても2個以上であってもならない。
また、コレクション型内オブジェクトのように名前を含めてはならない。

記述するプリミティブ型オブジェクトはいずれでもよい。

誤解を避けるために記述すると、オブジェクトツリーのルートにコレクション型を記述する場合、その内部に記述するオブジェクトの数にこの制限は適用されない。
つまり、XPOSデータに2個以上のデータを記述する場合、そのデータのルートは常にコレクション型となる。


## <a id="sec-5"></a> 5. Recommendation for Formulator - 仕様の策定者への勧告

この章は、XPOSデータフォーマットを用いた仕様を策定するにあたっての推奨を示すものである。

### <a id="sec-5-1"></a> 5.1. Object Placement Rules - オブジェクト配置の規則

オブジェクトはプリミティブ型で表現できる場合、可能な限りプリミティブ型データとして配置するべきである。
プリミティブ型で表現可能な何らかのデータ構造をバイナリとしてバイナリ型に格納することは移植性の低下につながることから、推奨しない。

例外として、同一データ型の大規模な配列や、圧縮されたデータを扱う場合は空間効率のためにもバイナリ型で記述したほうがよい。

データ構造をコレクション型に記述する場合、名前によってオブジェクトを識別する方法とデータの出現位置によってオブジェクトを識別する方法の二通りがあるが、そのどちらを用いるかは策定者の自由とする。

### <a id="sec-5-2"></a> 5.2. Date and Time Notation - 日付と時間の記述

日付、および時間をXPOSデータに記述する場合は、特定の時刻からの経過時間として整数型を用いて記述することを推奨する。

日付・時刻の記述に文字列型を用いた場合、ロケール等によって多様に変化するフォーマットに対応せねばならず、パーサーだけで大きなフットプリントを必要とするため、
また、整数型を用いたほうが日付・時刻の表現に必要なデータの大きさが通常小さく済むためである。

他にも、ユリウス日からの日数を実数で記述する方法も存在するが、XPOSで使用する浮動小数点数の記述では時刻によって精度が大きく変化するため、推奨しない。

日付、時刻の記述にあたって基準とする時刻、およびその経過時間を表すための時間の刻み幅はその仕様の策定者の自由とする。


## <a id="sec-6"></a> 6. Recommendation for Decorder - デコーダーへの勧告

### <a id="sec-6-1"></a> 6.1. Requirements - 実装における要求

XPOSデータフォーマットのデコーダーを実装する場合には、以下の要件を満たすべきである。

これらの要件は外部フォーマットがXPOSデータフォーマットを使用するにあたっての参考とするために記載している。

-	入れ子構造になったコレクション型オブジェクトに対して64の深さのデータの読み込みに対応する。

-	整数型オブジェクトに対して、単一長整数型で表現できる値と、システムで扱うことのできる最も大きな整数型が表現できる値のうち、いずれか大きい方のものを扱うことができる。

-	バイナリ型、文字列型、およびコレクション型オブジェクトに対して、少なくとも単一長整数型で表現できる値で扱えるサイズ(最大8388607バイト)のバイナリを扱うことができる。
	これは、必ずしもメモリに展開できる必要はなく、正しいデータに対してデータの読み取りやスキップがエラーなくできることを要求している。

-	実数型オブジェクトに対して、少なくともシステムで扱うことのできる最大の基本形式を扱うことができる。


## <a id="sec-7"></a> 7. Recommendation for Encoder - エンコーダーへの勧告

### <a id="sec-7-1"></a> 7.1. Real Number Type - 実数型の扱い

値を追加する場合、利用可能な形式のいずれを使用して記述してもよい。

ただし、値を更新する場合、異なる形式への変換はその必要がない限り行うべきではない。

